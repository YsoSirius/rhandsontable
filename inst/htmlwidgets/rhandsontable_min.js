function toArray(t){return t.map(function(t){return Object.keys(t).map(function(e){return t[e]})})}function csvString(t,e,a){for(var n=t.getColHeader(),r=n.join(e)+"\n",s=0;s<t.countRows();s++){var o=[];for(var i in n){var h=t.propToCol(i),l=t.getDataAtRowProp(s,h);isNaN(l)||(l=l.toString().replace(".",a)),o.push(l)}r+=o.join(e),r+="\n"}return r}function customRenderer(t,e,a,n,r,s,o){["date","handsontable","dropdown"].indexOf(o.type)>-1?type="autocomplete":type=o.type,Handsontable.renderers.getRenderer(type)(t,e,a,n,r,s,o)}function strip_tags(t,e){return e=(((e||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join(""),t.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,a){return e.indexOf("<"+a.toLowerCase()+">")>-1?t:""})}function safeHtmlRenderer(t,e,a,n,r,s,o){var i=Handsontable.helper.stringify(s);return t.getSettings().allowedTags?tags=t.getSettings().allowedTags:tags="<em><b><strong><a><big>",i=strip_tags(i,tags),e.innerHTML=i,e}HTMLWidgets.widget({name:"rhandsontable",type:"output",params:null,initialize:function(t,e,a){return{}},renderValue:function(t,e,a){e.data.length>0&&e.data[0].constructor===Array?e.data=e.data:e.data=toArray(e.data.map(function(t){return e.rColnames.map(function(e){return t[e]})})),e.overflow&&$("#"+t.id).css("overflow",e.overflow),e.rowHeaderWidth&&$("#"+t.id).css("col.rowHeader",e.rowHeaderWidth+"px"),this.params=e,a.hot?(a.hot.params=e,a.hot.updateSettings(e)):(a.hot=new Handsontable(t,e),this.afterChangeCallback(e),this.afterCellMetaCallback(e),this.afterRowAndColChange(e),e.selectCallback&&this.afterSelectCallback(e),a.hot.params=e,a.hot.updateSettings(e))},resize:function(t,e,a,n){},afterRender:function(t){t.afterRender=function(t){var e=this.getPlugin("autoColumnSize");if(e.isEnabled()&&this.params){e.widths;for(var a=0,n=this.countCols();a<n;a++)this.params.columns&&"customRenderer"!=this.params.columns[a].renderer.name&&e.calculateColumnsWidth(a,300,!0)}}},afterChangeCallback:function(t){t.afterChange=function(t,e){HTMLWidgets.shinyMode&&(!t||null===t[0][2]&&null===t[0][3]?"loadData"==e&&this.params&&Shiny.onInputChange(this.rootElement.id,{data:this.getData(),changes:{event:"afterChange",changes:null},params:this.params}):(this.sortIndex&&0!==this.sortIndex.length?c=[this.sortIndex[t[0][0]][0],t[0].slice(1,4)]:c=t,Shiny.onInputChange(this.rootElement.id,{data:this.getData(),changes:{event:"afterChange",changes:c,source:e},params:this.params})))},t.afterLoadData=function(t){},t.afterChangesObserved=function(t){},t.afterInit=function(){}},afterCellMetaCallback:function(t){t.afterSetCellMeta=function(t,e,a,n){HTMLWidgets.shinyMode&&"comment"===a&&Shiny.onInputChange(this.rootElement.id+"_comment",{data:this.getData(),comment:{r:t+1,c:e+1,key:a,val:n},params:this.params})}},afterSelectCallback:function(t){t.afterSelectionEnd=function(t,e,a,n){var r=[],s=[];if(HTMLWidgets.shinyMode){a<t&&(a=[t,t=a][0]);for(var o=t;o<=a;o++)r.push(this.toPhysicalRow(o)+1);n<e&&(n=[e,e=n][0]);for(var i=e;i<=n;i++)s.push(this.toPhysicalColumn(i)+1);Shiny.onInputChange(this.rootElement.id+"_select:rhandsontable.customSelectDeserializer",{data:this.getData(),select:{r:t+1,c:e+1,r2:a+1,c2:n+1,rAll:r,cAll:s},params:this.params})}}},afterRowAndColChange:function(t){t.afterCreateRow=function(t,e){if(HTMLWidgets.shinyMode){if(this.params&&this.params.columns)for(var a=0,n=this.countCols();a<n;a++)this.setDataAtCell(t,a,this.params.columns[a].default);Shiny.onInputChange(this.rootElement.id,{data:this.getData(),changes:{event:"afterCreateRow",ind:t,ct:e},params:this.params})}},t.afterRemoveRow=function(t,e){HTMLWidgets.shinyMode&&Shiny.onInputChange(this.rootElement.id,{data:this.getData(),changes:{event:"afterRemoveRow",ind:t,ct:e},params:this.params})},t.afterCreateCol=function(t,e){HTMLWidgets.shinyMode&&Shiny.onInputChange(this.rootElement.id,{data:this.getData(),changes:{event:"afterCreateCol",ind:t,ct:e},params:this.params})},t.afterRemoveCol=function(t,e){HTMLWidgets.shinyMode&&Shiny.onInputChange(this.rootElement.id,{data:this.getData(),changes:{event:"afterRemoveCol",ind:t,ct:e},params:this.params})}}});